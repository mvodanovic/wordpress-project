<VirtualHost *:443>
	ServerName {DOMAIN_NAME}

	ProxyPass / "https://localhost:{HOST_PORT_WORDPRESS}/"
	ProxyPassReverse / "https://localhost:{HOST_PORT_WORDPRESS}/"
	ProxyPreserveHost On
	ProxyAddHeaders On

	SSLEngine On
	SSLProxyEngine On
	SSLCertificateFile {ROOT_DIR}/ssl/{DOMAIN_NAME}.web.crt
	SSLCertificateKeyFile {ROOT_DIR}/ssl/{DOMAIN_NAME}.key
	SSLCACertificateFile {ROOT_DIR}/ssl/{CA_NAME}.ca.crt
	SSLProtocol -all +TLSv1.2

	<Location ~ "/wp-(login\.php|admin)">
		SSLVerifyClient require
		SSLVerifyDepth 1
		SSLRenegBufferSize 52428800
	</Location>

	ErrorLog {ROOT_DIR}/logs/{DOMAIN_NAME}.host.apache2.error.log
	LogFormat "%{X-Forwarded-For}i %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
	CustomLog {ROOT_DIR}/logs/{DOMAIN_NAME}.host.apache2.access.log combined
</VirtualHost>

<VirtualHost *:443>
        ServerName {PHPMYADMIN_DOMAIN_NAME}

        ProxyPass / "http://localhost:{HOST_PORT_PHPMYADMIN}/"
        ProxyPassReverse / "http://localhost:{HOST_PORT_PHPMYADMIN}/"
        ProxyPreserveHost On
        ProxyAddHeaders On

        SSLEngine On
        SSLProxyEngine On
        SSLCertificateFile {ROOT_DIR}/ssl/{PHPMYADMIN_DOMAIN_NAME}.web.crt
        SSLCertificateKeyFile {ROOT_DIR}/ssl/{PHPMYADMIN_DOMAIN_NAME}.key
        SSLCACertificateFile {ROOT_DIR}/ssl/{CA_NAME}.ca.crt

        SSLVerifyClient require
        SSLVerifyDepth 1

        ErrorLog  {ROOT_DIR}/logs/{PHPMYADMIN_DOMAIN_NAME}.host.apache2.error.log
        LogFormat "%{X-Forwarded-For}i %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
        CustomLog {ROOT_DIR}/logs/{PHPMYADMIN_DOMAIN_NAME}.host.apache2.access.log combined
</VirtualHost>

<VirtualHost *:443>
	ServerName www.{DOMAIN_NAME}

	RedirectTemp / https://{DOMAIN_NAME}/

	ErrorLog {ROOT_DIR}/logs/{DOMAIN_NAME}.host.apache2.error.log
	CustomLog {ROOT_DIR}/logs/{DOMAIN_NAME}.host.apache2.access.log combined
</VirtualHost>


<VirtualHost *:80>
	ServerName {DOMAIN_NAME}
	ServerAlias *.{DOMAIN_NAME}

        <Location ~ "^(?!\/\.well-known\/acme-challenge)\/.*">
                RedirectTemp / https://{DOMAIN_NAME}/
        </Location>

	ErrorLog {ROOT_DIR}/logs/{DOMAIN_NAME}.host.apache2.error.log
	CustomLog {ROOT_DIR}/logs/{DOMAIN_NAME}.host.apache2.access.log combined
</VirtualHost>

<VirtualHost *:80>
	ServerName {PHPMYADMIN_DOMAIN_NAME}

        <Location ~ "^(?!\/\.well-known\/acme-challenge)\/.*">
                RedirectTemp / https://{PHPMYADMIN_DOMAIN_NAME}/
        </Location>

	ErrorLog {ROOT_DIR}/logs/{PHPMYADMIN_DOMAIN_NAME}.host.apache2.error.log
	CustomLog {ROOT_DIR}/logs/{PHPMYADMIN_DOMAIN_NAME}.host.apache2.access.log combined
</VirtualHost>



# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
